# Система управления складом версия 0.0.1

## Оглавление

1. [Концепция системы](#карточка-проекта-концепция-системы)
2. [Тип проекта](#тип-проекта-серверная-часть-бекенд-nodejs-системы-управления-складом)
3. [Пользователи](#пользователи-системы)
4. [Роли пользователей](#роли-пользователей-в-системе)
5. [Функциональные требования](#основные-функциональные-требования)
6. [Дополнительные требования](#дополнительные-требования)
7. [Пользовательские требования](#пользовательские-требования)
8. [Проектирование REST API](#проектирование-rest-api)
9. [Участники](#участники)
10. [Обобщенный процесс взаимодействия с системой](#обобщенный-процесс-взаимодействия-с-системой)
11. [Проектирование методов](#проектирование-методов)
12. [Модель предметной области. ER diagram](#модель-предметной-области-er-diagram)

------------
**⚠️ ПРИМЕЧАНИЕ**

_Это учебный проект курса https://www.udemy.com/course/nodejs-start/ (https://learn.purpleschool.ru/public/products) в рамках которого необходимо отработать навык реализации слоеной архитектуры (middlewares, exceptions filters,  controller, error handler, services, repository, orm prisma) для выполнения CRUD операций с ресурсом (товары на складе) и JWT авторизация с ролевой моделью. Просьба не брать описание проекта за основу, так как он не выверен профессиональными системными аналитиками. Документацию на API привести в формате openAPI. Предоставить swagger.
CRUD для управления новыми пользователями в рамках данного релиза не требуется._

&#128736;  Инструменты для редактирования README.md
- https://github.com/GnuriaN/format-README/blob/master/README.md
- https://structurizr.com/
- https://tableconvert.com/markdown-generator
- https://pandao.github.io/editor.md/en.html
- https://editor.swagger.io/
- https://emojio.ru/objects/d83ddee0-1f6e0-molot-i-gaechnyy-klyuch.html
- https://www.udemy.com/course/microservices-with-node-js-and-react/learn/lecture/19099026#overview пример проектирования метода by Stephen Grider
------------


## Тип проекта: серверная часть (бекенд NodeJS) системы управления складом  

## Концепция системы (Фрагмент Карточки проекта)

| Карточка проекта              |                                                                                                                                                                                                                                          |
|-------------------------------|------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
| Автоматизируемая деятельность | Управление складом (отслеживание актуальным состоянием склада)                                                                                                                                                                           |
| Заинтересованные стороны      | Пользователи услуг склада, Владельц склада, Работники склада                                                                                                                                                                             |
| Текущее решение               | Учет и регистрация товаров на складе ведется вручную с использованием журналов                                                                                                                                                           |
| Решаемые проблемы             | Уменьшение ошибок, вызванных человеческим фактором: ошибки при записи в журнал, расчет количества остатков, учет суммарного веса, объема товаров, снижение затрат на бумажные носители, увеличение скорости обслуживания клиентов склада |
| Целевая ситуация              |                                                                                                                                                                                                                                          |
| Цель для заказчика            | Снизить расходы на операционную деятельность по управлению склада на 20%, увеличить приток клиентов на 15%                                                                                                                               |
| Назначение                    | Для пользователй услуг склада: увеличить скорость обслуживания от момента поступления заявки до выдачи или приемки товара на склад,                                                                                                      |
|                               | Для работника склада: автоматизировать процессы приемки и выдачи товаров, инвентаризации склада                                                                                                                                          |

## Основные функциональные требования
_Лексическая формула требований: [Условие][Субъект][Действие][Объект][Ограничение/Значение]_  
### Релиз 1
1. Система должна хранить информацию о заполненности склада товарами (Емкость склада ограничена площадью зоны хранения)
2. Система должна поддерживать авторизированный доступ к системе с ограничением по доступу к функционалу согласно ролевой модели. 
3. Система должна обеспечивать генерацию нового типа Пользователя с набором прав доступа (Администратор, Начальник склада)
4. Система должна обеспечить по запросу Пользователя операцию по предоставлению всех товаров на складе.   
5. Система должна обеспечить по запросу Пользователя операцию по добавлению товара на склад с указанием причины добавления и источника.
6. Система должна обеспечить по запросу Пользователя операцию по удалению товара со склада, направление убытия и причина убытия.  
7. Система должна обеспечить по запросу Пользователя операцию по изменению свойств товара с указанием причин изменения. Нулевое значение количества отстатков не приводит к удалению товара со склада.
8. Система должна обеспечить поиск с фильтрацией товара на складе по различным параметрам, таким как наименование товара, количество, стоимость, дата добавления.

## Пользователи системы

| Пользователь | Описание                                       |
|------------------------------------|---|
| Работник | Работник склада. Роль - Администратор системы      |
| Работник | Работник склада. Роль - Начальник склада           |

## Пользовательские требования

> **Пользовательские требования** - это требования, выраженные пользователями и описывающие, каким образом система должна быть использована. Эти требования обычно формулируются на естественном языке и представляют собой описание того, что должна делать система для пользователя, а не как она это должна делать.  
**Функциональные требования**, с другой стороны, описывают, каким образом система должна выполнять конкретную функцию или задачу. Они описывают, что должна делать система и как она должна это делать. Функциональные требования обычно выражаются в терминах конкретных функций, операций или процессов, которые система должна выполнять.  
**Таким образом**, пользовательские требования фокусируются на том, что должна делать система для пользователя, а функциональные требования - на том, каким образом это должно происходить в системе.

### Реестр пользовательских требований. 
Релиз 1
| №UserReq | Пользовательское требование                                                                                            |
|----------|------------------------------------------------------------------------------------------------------------------------|
| 1        | Возможность авторизироваться в системе и получать доступ к своим данным и функционалу в соответствии с ролью.          |
| 2       | Возможность создавать нового пользователя в системе с набором прав доступа.                                             |
| 3       | Возможность удаления пользователя.                                             |
| 4        | Возможность просматривать список товаров или один товар с остатками на складе с возможностью фильтрации по категориям и характеристикам товаров.  |
| 5        | Возможность добавлять новый товар на склад с указанием причины добавления и источника.                                 |
| 6        | Возможность удалять товар со склада с указанием причины убытия и направления убытия.                                   |
| 7        | Возможность обновлять характеристики товара на складе с указанием причины изменения.                                    |
| 8        | Возможность поиска товара на складе с использованием фильтрации по характеристикам товара.                             |
| 9        | Возможность изменять количество товара на складе с указанием причины изменения.                                        |

### Роли пользователей в системе

**Релиз 1**
_для учебных целей пропущена регистрация_

Ролевая модель **Роль: Администратор**
|  №UserReq | Описание   |
| :------------: | :------------: |
| 2 | Создание нового пользователя  |
| 3 | Удаление пользователя  |
| 5 | Добавление нового товара  |
| 6 | Удаление товара  |
| 7 | Обновление информации о товаре  |
| 9 | Изменение остатков на складе |

Ролевая модель **Роль: Начальник склада**
|  №UserReq | Описание   |
| :------------: | :------------: |
| 9 | Изменение остатков на складе |

Ролевая модель **Роль: общий доступ для всех зарегистированных сотрудников склада**
|  №UserReq | Описание   |
| :------------: | :------------: |
| 1 | Авторизация  |
| 4 | Получение списка товаров |
| 4 | Получение конкретного товара |
| 8  | Поиск товара с поисковыми параметрами фильтрации |

## Проектирование REST API
Процесс интеграции Клиент - Сервис:  
#### Разбиение на ресурсы (сущности) и методы работы с ними
**Управление ресурсом "Пользователи"**
1. Авторизация пользователя
2. Создание нового пользователя с набором ролей
5. Обновление информации о пользователе
6. Удаление пользователя

**Управление ресурсом "Товары на складе"**
1. Получение списка товаров
2. Получение информации о конкретном товаре
3. Создание нового товара
4. Обновление информации о товаре
5. Удаление товара
6. Поиск товара с поисковыми параметрами фильтрации
7. Изменение остатков на складе (отдельный метод на изменение количества товара на складе)
8. Получение остатка конкретного товара

продумать сущность 
Роли (хранить права доступа), 
Склад (хранить емкость склада в площади, объеме, весе?, место хранения(индекс массива) - товар - количество (дублируем и имитируем место хранения)

### Участники:
Работник склада - Администратор  
Работник склада - Работник: "Начальник склада"  
Система управления складом (бекенд)  

### Обобщенный процесс взаимодействия с системой
Пользователь отправляет запрос в Систему     
Система получает запрос  
Система проверяет запрос на корректность  
Система проверяет запрос на правомерность доступа  
Система выполняет запрос и отдает ответ, включая HTTP статус и json с требуемой информацией   
### Проектирование REST API

#### Диаграмма последовательности
```mermaid
sequenceDiagram
actor User
User -> Controller: weather in city {city}
Controller -> Service: call service {city}
Service -> WeatherServiceController: call the weather data 
WeatherServiceController --> Service: return weather data
Service --> Controller: return data 
Controller --> User: response
Note right of Controller: {"city": "Москва", "temperature": "-5 °C", "weather": "Облачно с прояснениями", "wind": "10 км/ч"}
```

## Архитектура системы и проектное решение

- Пользовательский интерфейс
  - Представлен RESTful API на Node.js с использованием пакета express
- Middleware
  - Обрабатывает GET запроса по роуту /api/v1/weatherincity
  - Валидирует параметры запроса на наличие обязательного параметра `city`
- Controller
  - Использует маршрутизацию запросов с помощью пакета express
  - При получении запроса на /api/v1/weatherincity передает его в слой бизнес-логики
- Adapter
  - Обращается к API сервису https://openweathermap.org/api с помощью пакета axios
  - Передает параметры запроса в формате, необходимом для API сервиса с ключом API и названием города
- Бизнес-логика
  - Получает запрос от Controller и трансформирует его в формат, необходимый для API сервиса, добавляя к запросу ключ API и приводит название города к нужному формату.
  - Отправляет запрос к API сервису с помощью Adapter и получает ответ
  - Обрабатывает полученные данные, выбирая только необходимые поля и трансформируя их для передачи в ответ клиенту в формате json
- Exceprion handler
  - Обрабатывает ошибки, возникающие в Middleware, Controller и Business Logic.
  - Возврат пользователю ответа в едином формате с уведомлением об ошибке
  - Логирование ошибок для последующего анализа

## Модель предметной области. ER diagram

```mermaid
erDiagram
    Warehouse ||..o{ Products : save

    Products ||..|| Category : has

    Products ||..|| Suppliers : has
    
    Warehouse ||..o{ Employeers : has
    Warehouse ||..o{ Clients : has
    Clients ||..o{ Orders : has
    Orders ||..o{ Order_cartID : has
    Products ||..|| Order_cartID : has

    Warehouse {
        int ID
        string Address
        string Area
        int Max_capacity
    }
    Products {
        int ID
        string Name
        string Description
        int Quantity
        float Price
        int CategoryID
        int SupplierID
    }

    Category {
        int ID
        string Name
        string Description
    }

    Suppliers {
        int ID
        string Company_name
        string Contact_information
    }

    Employeers {
        int ID
        string First_Name
        string Last_Name
        string Login
        string Password
        string Role
    }

    Clients {
        int ID
        string First_Name
        string Last_Name
        string Login
        string Password
        string Role
    }

    Orders {
        int ID
        date Order_data
        string Storage_start
        string Storage_end
        string Status
        int Order_cartID
        int CategoryID
        int ClientID
    }

Order_cartID {
        int ID
        int OrderID
        int ProductID
}
```

## Физическая модель данных для ORM Prisma NodeJS
    model User {
      id         Int      @id @default(autoincrement())
      firstName  String
      lastName   String
      login      String   @unique
      password   String
      role       Role     @default(USER)
      createdAt  DateTime @default(now())
      updatedAt  DateTime @updatedAt
      orders     Order[]
    }
    
    model Category {
      id          Int        @id @default(autoincrement())
      name        String
      description String?
      products    Product[]
    }
    
    model Product {
      id          Int       @id @default(autoincrement())
      name        String
      description String?
      quantity    Int
      price       Float
      category    Category @relation(fields: [categoryId], references: [id])
      categoryId  Int
      supplier    Supplier @relation(fields: [supplierId], references: [id])
      supplierId  Int
      inventories Inventory[]
    }
    
    model Inventory {
      id         Int      @id @default(autoincrement())
      quantity   Int
      updateDate DateTime @default(now())
      productId  Int
      product    Product  @relation(fields: [productId], references: [id])
    }
    
    model Supplier {
      id               Int       @id @default(autoincrement())
      companyName      String
      address          String
      contactInformation String
      products         Product[]
    }
    
    model Warehouse {
      id          Int       @id @default(autoincrement())
      address     String
      area        Float
      warehouseType String
      maxCapacity Int
    }
    
    model Order {
      id               Int       @id @default(autoincrement())
      orderDate        DateTime  @default(now())
      storageStartDate DateTime?
      storageEndDate   DateTime?
      orderStatus      String
      client           User      @relation(fields: [clientId], references: [id])
      clientId         Int
    }
    
    enum Role {
      ADMIN
      CLIENT
      EMPLOYEE
    }

